<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./assets/css/style.css">
</head>

<body>
    <div class="tudo">
        <div class="container">
            <div>
                <div class="score">
                    <div class="box">
                        <div class="jogador">Jogador 1 </div>
                        <div class="jogador">Jogador 2</div>
                    </div>
                    <div class="box">
                        <div class="textoJogador">Pontuação</div>
                        <div class="textoJogador">Pontuação </div>
                    </div>
                </div>
                <div id="div_jogo"></div>
            </div>
            <div class="profile">
                Timer:
                <p id="timer"><button onclick="temporizador()">Começar</button></p>
                <p id="timerAper"><span id="tempoMin">Você tem 1 minuto</span></p>
                <div class="link" id="link">
                    <img src="../imgs/linkNormal.png" alt="">
                </div>
                <div class="aconteceu">
                    <p id="aconteceu_texto">AAA</p>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    const idPartida = sessionStorage.ID_PARTIDA;
    const itemBom = [];
    function gerar() {
        jogo = document.getElementById("div_jogo")
        let indice = 0
        fetch(`/sala/getContext/${idPartida}`, {
            method: "GET",
        }).then(function (resposta) {
            if (resposta.ok) {
                console.log(resposta);
                resposta.json().then(json => {
                    for(let i = 0; i < 100; i++){
                            if(json[i]){
                                jogo.innerHTML += `<div class="espaco" style='order: ${json[i].pos}' id="${indice}" data-status="${json[i].tipo}" onclick="verificar(${indice})"></div>`;
                            } else{
                                jogo.innerHTML += `<div class="espaco" style='order: ${indice}' id="${indice}" data-status="${2}" onclick="verificar(${indice})"></div>`;
                            }
                            indice++
                        }
                    });

            } else {

                console.log("Houve um erro a buscar partida");

                resposta.text().then(texto => {
                    console.error(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })
    }

    const itensR = ["assets/imgs/inimigo.png"]
    const itensB = ["assets/imgs/cogumelo.png"]

    function verificar(id) {
        div = document.getElementById(id)
        divStatus = div.dataset.status
        console.log(divStatus);
        console.log(divStatus)

        let numero = Math.floor(Math.random() * itensR.length)
        let numero2 = Math.floor(Math.random() * itensB.length)
        if (divStatus == 0) {
            div.innerHTML = `<img src="${itensR[numero]}"></img>`
            aconteceu_texto.innerText = "Link sofreu um evento inesperado"
            link.innerHTML = `<img src="./assets/imgs/linkDmg.png"></img>`
        } else if (divStatus == 1) {
            div.innerHTML = `<img src="${itensB[numero2]}"></img>`
            aconteceu_texto.innerText = "Link sofreu um evento inesperado"
            link.innerHTML = `<img src="./assets/imgs/linkBom.png"></img>`
        } else {
            div.style.background = 'rgba(0,0,0,0.5)'
            aconteceu_texto.innerText = "Nada aconteceu"
            link.innerHTML = `<img src="./assets/imgs/linkNormal.png"></img>`
        }
    }
    gerar()

    let timeout;
    function temporizador() {

        timeout = setTimeout(alertFunc, 60000)
        document.getElementById("timer").style.display = "none"
        document.getElementById("timerAper").style.display = "flex"
    }

    function alertFunc() {
        alert("Seu tempo acabou!")
    }

</script>

</html>